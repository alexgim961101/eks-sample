# ============================================================================
# Terraform Backend ì„¤ì •
# ============================================================================
# ì´ íŒŒì¼ì€ Terraform ìƒíƒœ(State)ë¥¼ ì–´ë””ì— ì €ì¥í• ì§€ ì •ì˜í•©ë‹ˆë‹¤.
#
# ğŸ’¡ Backendë€?
# --------------
# Terraformì€ ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ì˜ í˜„ì¬ ìƒíƒœë¥¼ "State íŒŒì¼"ì— ì €ì¥í•©ë‹ˆë‹¤.
# BackendëŠ” ì´ State íŒŒì¼ì„ ì–´ë””ì— ì €ì¥í• ì§€ ê²°ì •í•©ë‹ˆë‹¤.
#
# ğŸ’¡ ì™œ S3 Backendë¥¼ ì‚¬ìš©í•˜ë‚˜?
# ----------------------------
# 1. íŒ€ í˜‘ì—…: ìƒíƒœ íŒŒì¼ì„ ì¤‘ì•™ì—ì„œ ê³µìœ 
# 2. ì•ˆì „ì„±: S3ì˜ ë²„ì „ ê´€ë¦¬ë¡œ ì‹¤ìˆ˜ë¡œ ì‚­ì œí•´ë„ ë³µêµ¬ ê°€ëŠ¥
# 3. ë™ì‹œ ìˆ˜ì • ë°©ì§€: DynamoDBë¡œ Lockì„ ê±¸ì–´ í•œ ë²ˆì— í•œ ì‚¬ëŒë§Œ ìˆ˜ì • ê°€ëŠ¥
#
# âš ï¸ ì£¼ì˜ì‚¬í•­:
# - ì•„ë˜ bucket ê°’ì€ setup-backend.sh ì‹¤í–‰ í›„ ì¶œë ¥ëœ ê°’ìœ¼ë¡œ ìˆ˜ì •í•˜ì„¸ìš”!
# - bucket ì´ë¦„ì€ ì „ ì„¸ê³„ì ìœ¼ë¡œ ê³ ìœ í•´ì•¼ í•©ë‹ˆë‹¤.
# ============================================================================

terraform {
  backend "s3" {
    # âš ï¸ ì´ ê°’ì„ setup-backend.sh ì‹¤í–‰ í›„ ì¶œë ¥ëœ ë²„í‚· ì´ë¦„ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”!
    bucket = "eks-terraform-state-894759291324"

    # State íŒŒì¼ ê²½ë¡œ (í™˜ê²½ë³„ë¡œ ë¶„ë¦¬)
    # dev í™˜ê²½ì˜ ìƒíƒœëŠ” ì´ ê²½ë¡œì— ì €ì¥ë©ë‹ˆë‹¤.
    key = "environments/dev/terraform.tfstate"

    # AWS ë¦¬ì „
    region = "ap-northeast-2"

    # State íŒŒì¼ ì•”í˜¸í™” (ë³´ì•ˆì„ ìœ„í•´ í•„ìˆ˜!)
    encrypt = true

    # State Lockingìš© DynamoDB í…Œì´ë¸”
    # ë™ì‹œì— terraform applyë¥¼ ì‹¤í–‰í•˜ë©´ í•˜ë‚˜ëŠ” Lockì´ í’€ë¦´ ë•Œê¹Œì§€ ëŒ€ê¸°í•©ë‹ˆë‹¤.
    dynamodb_table = "eks-terraform-locks"
  }
}
